function collision(a,b,c,d,e,f,g,h){return a<d&&e<h&&c<b&&g<f}function location_clicked(a,b,c,d){return!!(mouse_x>a&&mouse_x<b&&mouse_y>c&&mouse_y<d&&(1&mouse_b||2&mouse_b))}function distance_to_object(a,b,c,d){return sqrt(pow(a-c,2)+pow(b-d,2))}function find_angle(a,b,c,d){var e=0,f=0;return e=b-d,f=a-c,Math.atan2(f,e)}function location_right_clicked(a,b,c,d){return!!(mouse_x>a&&mouse_x<b&&mouse_y>c&&mouse_y<d&&4&mouse_b)}function restart_game(){beat_highscore&&(high_minutes=minutes,high_seconds=seconds,beat_highscore=0),is_alive=!0,seconds=0,frames=0,minutes=0,gameObjects.splice(0,gameObjects.length),create_asteroid(0,0),create_asteroid(0,0),create_asteroid(0,0),spaceship_x=500,spaceship_y=400}function create_asteroid(a,b){var c=0,d=0;if(2!=a){var e=Math.ceil(4*Math.random());if(1==a&&(c=Math.random()*b-1,d=Math.random()*b-1),1==e)var f=new object(100+1160*Math.random(),0,a,c,d);if(2==e)var f=new object(100+1160*Math.random(),920,a,c,d);if(3==e)var f=new object(1160,100+920*Math.random(),a,c,d);if(4==e)var f=new object(0,100+920*Math.random(),a,c,d);gameObjects.push(f)}else{var f=new object(100+1160*Math.random(),100+920*Math.random(),a,c,d);gameObjects.push(f)}}function draw(){if(1==GAME_STATE){for(draw_sprite(canvas,background,100,100),is_alive&&rotate_sprite(canvas,spaceship,spaceship_x,spaceship_y,angle_allegro),i=0;i<gameObjects.length;i++)gameObjects[i].draw();draw_sprite(canvas,frame,0,0),is_alive&&(high_seconds<10?textout(canvas,font,"Highscore: "+high_minutes+":0"+high_seconds,100,40,40,makecol(0,0,0)):textout(canvas,font,"Highscore: "+high_minutes+":"+high_seconds,100,40,40,makecol(0,0,0)),seconds<10?textout(canvas,font,minutes+":0"+seconds,100,80,40,makecol(0,0,0)):textout(canvas,font,minutes+":"+seconds,100,80,40,makecol(0,0,0))),is_alive||(textout(canvas,font,"You died. Press R to restart",100,40,40,makecol(0,0,0)),high_minutes<minutes||high_minutes==minutes&&seconds>high_seconds?(beat_highscore=!0,seconds<10?textout(canvas,font,"New Highscore!: "+minutes+":0"+seconds,100,80,40,makecol(0,0,0)):textout(canvas,font,"New Highscore!: "+minutes+":"+seconds,100,80,40,makecol(0,0,0))):seconds<10?textout(canvas,font,minutes+":0"+seconds,100,80,40,makecol(0,0,0)):textout(canvas,font,minutes+":"+seconds,100,80,40,makecol(0,0,0)))}0==GAME_STATE&&(draw_sprite(canvas,frame,0,0),draw_sprite(canvas,background,100,100),draw_sprite(canvas,main_menu,100,100)),2==GAME_STATE&&(draw_sprite(canvas,frame,0,0),draw_sprite(canvas,background,100,100),draw_sprite(canvas,help,100,100)),3==GAME_STATE&&(draw_sprite(canvas,frame,0,0),draw_sprite(canvas,background,100,100),draw_sprite(canvas,about,100,100))}function update(){if(tick+=1,1==GAME_STATE){if(key[KEY_ESC]&&(GAME_STATE=0,restart_game()),key[KEY_R]&&restart_game(),is_alive&&frames++,60==frames&&(seconds++,frames=0),seconds%10==0&&0==frames){if(minutes>0)for(i=0;i<5*(minutes+1);i++)create_asteroid(1,2*(minutes+1));for(i=0;i<3*(minutes+1);i++)create_asteroid(0,0),create_asteroid(2,0)}for(60==seconds&&(seconds=0,minutes++),i=0;i<gameObjects.length;i++)gameObjects[i].update(),(gameObjects[i].getX()>1300||gameObjects[i].getX()<-200||gameObjects[i].getY()<-200||gameObjects[i].getY()>1300)&&gameObjects.splice(i,1);angle+=1,256==angle&&(angle=0),spaceship_x>1014&&(spaceship_x=1014),spaceship_x<100&&(spaceship_x=100),spaceship_y>774&&(spaceship_y=774),spaceship_y<100&&(spaceship_y=100),is_alive?(angle_radians=find_angle(spaceship_x,spaceship_y,mouse_x,mouse_y),angle_degrees=57.2957795*angle_radians,angle_allegro=angle_degrees/1.41176470588,spaceship_x_velocity=-(spaceship_x-mouse_x)/speed,spaceship_y_velocity=-(spaceship_y-mouse_y)/speed,spaceship_x+=spaceship_x_velocity,spaceship_y+=spaceship_y_velocity):(spaceship_x=1e4,spaceship_y=1e4)}0==GAME_STATE&&tick>10&&(location_clicked(390,800,460,560)&&(tick=0,restart_game(),create_asteroid(0,0),create_asteroid(0,0),create_asteroid(0,0),GAME_STATE=1),location_clicked(390,800,560,660)&&(tick=0,GAME_STATE=2),location_clicked(390,800,660,760)&&(tick=0,GAME_STATE=3)),2!=GAME_STATE&&3!=GAME_STATE||(1&mouse_b&&tick>10&&(GAME_STATE=0,tick=0),key[KEY_ESC]&&(GAME_STATE=0))}function setup(){frame=load_bmp("images/frame.png"),background=load_bmp("images/background.png"),main_menu=load_bmp("images/main_menu.png"),asteroid_large=load_bmp("images/asteroid_large.png"),asteroid_small=load_bmp("images/asteroid_small.png"),spaceship=load_bmp("images/spaceship.png"),vortex=load_bmp("images/vortex.png"),help=load_bmp("images/help.png"),about=load_bmp("images/about.png"),music=load_sample("audio/music.mp3"),vortex_sfx=load_sample("audio/vortex_sfx.mp3"),death_sfx=load_sample("audio/death_sfx.mp3"),play_sample(music,255,1e3,1)}function main(){return enable_debug("debug"),allegro_init_all("game_canvas",1160,920),setup(),ready(function(){loop(function(){clear_to_color(canvas,makecol(255,255,255)),update(),draw()},BPS_TO_TIMER(60))}),0}var background,frame,asteroid_small,vortex,spaceship,angle=0,spaceship_x=500,spaceship_y=400,angle_allegro=0,angle_degrees=0,angle_radians=0,spaceship_x_velocity=0,spaceship_y_velocity=0,speed=50,gameObjects=[],is_alive=!0,seconds=0,minutes=0,frames=0,high_minutes=0,high_seconds=0,beat_highscore=!1,music,vortex_sfx,death_sfx,main_menu,about,help,tick=0,GAME_STATE=0,object=function(a,b,c,d,e){this.type=c,this.x=a,this.y=b,this.x_velocity=d,this.y_velocity=e};object.prototype.getX=function(){return this.x},object.prototype.getY=function(){return this.y},object.prototype.getType=function(){return this.type},object.prototype.draw=function(){0==this.type&&draw_sprite(canvas,asteroid_small,this.x,this.y),1==this.type&&draw_sprite(canvas,asteroid_large,this.x,this.y),2==this.type&&rotate_sprite(canvas,vortex,this.x,this.y,angle)},object.prototype.update=function(){1==GAME_STATE&&(0==this.type&&(this.x>spaceship_x&&(this.x-=.5),this.x<spaceship_x&&(this.x+=.5),this.y<spaceship_y&&(this.y+=.5),this.y>spaceship_y&&(this.y-=.5),collision(this.x+5,this.x+40,spaceship_x,spaceship_x+30,this.y+5,this.y+30,spaceship_y,spaceship_y+30)&&(is_alive=!1,play_sample(death_sfx))),1==this.type&&(this.x+=this.x_velocity,this.y+=this.y_velocity,collision(this.x+10,this.x+82,spaceship_x+10,spaceship_x+30,this.y+10,this.y+90,spaceship_y+10,spaceship_y+30)&&(is_alive=!1,play_sample(death_sfx))),2==this.type&&collision(this.x+10,this.x+30,spaceship_x+10,spaceship_x+30,this.y+10,this.y+30,spaceship_y+10,spaceship_y+30)&&(is_alive=!1,play_sample(vortex_sfx)))},END_OF_MAIN();